<app-page-layout-admin>
  <app-list-register-page-layout
    title="Produtos"
    addLabel="Novo"
    [isLoading]="isLoading()"
    [hasMore]="hasMoreData()"
    (add)="openDialogFood()"
    (searchChange)="onSearchChange($event)"
    (loadMore)="loadMore()"
    [showAddButton]="false"
    [selectedId]="selectedCategoryId()"
    [selectItems]="categories()"
    (itemSelected)="onCategorySelected($event)"
  >
    <ng-container customHeader>
      <div class="flex flex-col gap-2">
        <div class="relative flex justify-end gap-2 shadow-sm rounded-md text-black">
          <button
            class="bg-primary px-4 py-2 rounded-md text-white flex items-center gap-2"
            (click)="isOpen.set(!isOpen())"
          >
            <i class="fa-solid fa-gear"></i>
            Gerenciar Itens
          </button>
          @if (isOpen()) {
            <div
              @fadeScale
              class="absolute right-0 top-[35px] mt-2 w-56 bg-white border rounded shadow-md z-50"
            >
              <button
                class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
                (click)="openCategoryDialog(); isOpen.set(false)"
              >
                <i class="fa-solid fa-plus"></i>
                Criar item
              </button>
              <button
                class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
              >
                          <!-- (click)="openDialogSubcategories(); isOpen.set(false)" -->
                <i class="fa-solid fa-layer-group"></i>
                Subcategorias
              </button>
              <div class="relative group">
              <button
                class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
              >
                <i class="fa-solid fa-puzzle-piece"></i>
                Adicionais
                <i class="fa-solid fa-chevron-right ml-auto"></i>
              </button>
              <div
                class="absolute left-10 top-8 ml-1 mt-0 w-48 bg-white border rounded shadow-md hidden group-hover:block z-50"
              >
                <button
                  class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
                >
                  <!-- (click)="openDialogExtra(); isOpen.set(false)" -->
                  <i class="fa-solid fa-plus"></i> Adicionar
                </button>
                <button
                  class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
                >
                            <!-- (click)="openDialogManageExtra(); isOpen.set(false)" -->
                <i class="fa-solid fa-gear"></i>
                  Gerenciar
                </button>
              </div>
            </div>
              <button
                class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"
              >
              <!-- (click)="openDialogFee(); isOpen.set(false)" -->
                <i class="fa-solid fa-truck"></i>
                Taxa de entrega
              </button>
            </div>
          }
        </div>
      </div>
    </ng-container>
    <ng-container list>
      @for (food of items(); track food.id) {
        <div class="bg-white rounded-md shadow-md p-3 flex flex-col gap-2 border border-primary/10 cursor-pointer text-black" (click)="openDialogFood(food)">
          <div class="flex items-center gap-3">
            <img
              [src]="food.image_url"
              alt="{{ food.name }}"
              class="w-16 h-16 object-cover rounded-md border border-gray-200 bg-gray-50"
            />
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-base text-gray-900 truncate">{{ food.name }}</div>
              <div class="text-xs text-gray-500 truncate">
                Categoria: <span class="font-medium text-primary">{{ food.category.name }}</span>
              </div>
              <div class="text-sm text-primary font-bold mt-1">R$ {{ food.price }}</div>
            </div>
            <div class="flex flex-col gap-2 ml-2 z-30">
              <app-icon-button icon="fa-solid fa-pen-to-square" (click)="openDialogFood(food); $event.stopPropagation()" />
              <app-icon-button icon="fa-solid fa-trash" (click)="openDialogRemoveFood(food); $event.stopPropagation()" />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2 text-xs text-gray-600 mt-2">
            <div>
              <span class="font-semibold">Descrição:</span>
              <span class="line-clamp-2">{{ food.description || '-' }}</span>
            </div>
          </div>
        </div>
      }
      @empty {
        <div class="text-center text-gray-400 mt-10">Nenhum produto encontrado.</div>
      }
    </ng-container>

  </app-list-register-page-layout>
</app-page-layout-admin>
